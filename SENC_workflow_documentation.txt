# Workflow for SENC simulations

FILE:   sims_only_workflow_local.r
---------------------------------
FILE INPUTS:   
 DATA
  SENC_Master_Simulation_Matrix.csv 
    Table listing the parameter combinations of every simulation to be run.
 SCRIPTS
  senc_sim_fun.r
    Runs an entire simulation for one sim ID (i.e., one combination of simulation parameters)

VARIABLE INPUTS:
  which.sims
    The sim IDs for which simulations should be run

FILE OUTPUTS:   (all saved in 'raw_sim_output' folder; XXX specifies simID)
  SENC_all.pops_simXXX.csv
    Simulation output containing all spatial, temporal and trait information for every
    population to arise over the course of the simulation.
    region:   spatial region number
    spp.name:   species identifier
    extant:   species extant as of the most recent time step (1) or extinct (0)
    env.opt:   environmental optimum of the species, ranging from ~0-40
    time.of.origin:   time at which the species appeared in the region. If this is a first
      appearance due to having newly speciated, then time.of.origin should equal
      time.of.sp.origin. More likely, the appearance is due to colonization from an
      adjacent region.
    time.of.extinction:   time at which the species disappears from the region. Most often
      this will reflect the timing of a local extinction.
    time.of.sp.origin:   time at which the species first appeared in the simulation due to
      speciation.
    time.of.sp.extinction:   time at which the species went globally extinct. If it did not
      go extinct, then its value is the number of time steps the simulation was run plus 1.
    reg.env:   the average temperature of the region.
    carry.cap:   the carrying capacity (over all species) of the region.
  SENC_time.rich_simXXX.csv
    Summary of the number of species in each region at each time step in the simulation.
  SENC_phylo_simXXX.tre
    Object of class 'phylo' describing phylogenetic relationships among simulation species.
  SENC_params.out_simXXX.csv
    Simulation parameters used for simulation XXX.



# Workflow for analysis of SENC simulation output

FILE:   analysis_workflow_Olympus.r
---------------------------------
FILE INPUTS:   
 DATA
  SENC_Master_Simulation_Matrix.csv 
    Table listing the parameter combinations of every simulation to be run.
  senc.out.XXX.zip
    Zipped output files where XXX is the simulation id, ranging from 1 to ~4000
 SCRIPTS
  unzipping_files.r
    Unzips simulation output of the form senc.out.XXX.zip, stores info in sim.results
  reg_calc_and_analysis.r
    
  extinct.calc.r
    Calculates an extinction rate for each region
  make.phylo.jimmy.fun.r
    Makes a phylogeny from the edge and edge.length info collected during the simulation
  lat.grad.time.plot.r
    Makes the lat_grad_thru_time_simXXX.pdf plots.
  clade.origin.corr.plot.r
    Makes the corr_vs_cladeage_simXXX.pdf plots.
  clade.exmpl.figs.r 
    Makes clade_example_figs_simXXX.pdf plots. Currently broken.

VARIABLE INPUTS:   
  number.of.time.slices
    The number of points in time over the course of the simulation to analyze results.
  min.num.spp
    The minimum number of species a clade must have to be analyzed as its own entity.
  Allen
    If Allen==1, then various local paths are specified to read and write files
    correctly on Allen's office machine. If Allen==0, then paths should be set for
    James' working environment.

FILE OUTPUTS:
  SENC_Stats_simXXX.csv
    Often referred to as the "stats" file or "output" file. For each subclade and at
    each specified timeslice within simulation XXX, the following information is stored:
    simID, cladeID, time, correlation coefficients and p-values for correlations among
    richness, environment, region, MRD, and PSV, Pybus & Harvey's gamma statistic, and
    Blomberg's K for both environmental optimum and mean region of occurrence.
  lat_grad_thru_time_simXXX.pdf
    Plot of species richness versus latitude for ten equally spaced points in time from
    throughout the simulation.
  corrs_vs_cladeage_simXXX.pdf
    9-panel bivariate plots with clade origin time (the inverse of clade age) on the X
    and the various variables from SENC_Stats_simXXX.csv on the Y.
    NOTE:   Need to modify to include the two Blomberg's K values as two additional plots.
  sim.matrix.output_YYYY-MM-DD.csv
    One row for each simulation with summary information regarding the simulation
    parameters, the total number of regions over which species occurred, the number of 
    extant species, the number of species going extinct over the simulation, the number
    of clades that were skipped in analysis because they were smaller than the min.num.spp
    threshold, the number of timeslices that were skipped because there were insufficient
    species (usually timeslices very early on under a limited range of parameters), and
    the total number of rows of output in that simulation's SENC_Stats_simXXX.csv file.